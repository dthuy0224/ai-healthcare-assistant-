{% extends "base.html" %}

{% block title %}AI Health Assessment - Comprehensive Health Analysis{% endblock %}

{% block css %}
<link rel="stylesheet" href="/static/css/assessment.css">
<link rel="stylesheet" href="/static/css/assessment-interface.css">
<link rel="stylesheet" href="/static/css/assessment-steps.css">
{% endblock %}

{% block content %}
<div class="assessment-wrapper">
    <!-- Side Navigation -->
    <div class="assessment-sidebar">
        <div class="sidebar-header">
            <div class="assessment-logo">
                <svg class="medical-cross" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C13.1 2 14 2.9 14 4V10H20C21.1 10 22 10.9 22 12C22 13.1 21.1 14 20 14H14V20C14 21.1 13.1 22 12 22C10.9 22 10 21.1 10 20V14H4C2.9 14 2 13.1 2 12C2 10.9 2.9 10 4 10H10V4C10 2.9 10.9 2 12 2Z" />
                </svg>
                <h2>Health Assessment</h2>
            </div>
            <p class="assessment-subtitle">Comprehensive AI-Powered Analysis</p>
        </div>

        <!-- Progress Navigation -->
        <nav class="step-navigation">
            <div class="nav-step active" data-step="1">
                <div class="step-indicator">
                    <span class="step-number">1</span>
                    <div class="step-check">‚úì</div>
                </div>
                <div class="step-info">
                    <h3>Basic Health Profile</h3>
                    <p>Age, gender, physical stats</p>
                </div>
            </div>
            
            <div class="nav-step" data-step="2">
                <div class="step-indicator">
                    <span class="step-number">2</span>
                    <div class="step-check">‚úì</div>
                </div>
                <div class="step-info">
                    <h3>Symptom Input</h3>
                    <p>Describe your concerns</p>
                </div>
            </div>
            
            <div class="nav-step" data-step="3">
                <div class="step-indicator">
                    <span class="step-number">3</span>
                    <div class="step-check">‚úì</div>
                </div>
                <div class="step-info">
                    <h3>Contextual Questions</h3>
                    <p>Detailed medical history</p>
                </div>
            </div>
            
            <div class="nav-step" data-step="4">
                <div class="step-indicator">
                    <span class="step-number">4</span>
                    <div class="step-check">‚úì</div>
                </div>
                <div class="step-info">
                    <h3>AI Analysis</h3>
                    <p>Results & recommendations</p>
                </div>
            </div>
        </nav>

        <!-- Save Progress -->
        <div class="save-progress">
            <div class="auto-save-indicator">
                <div class="save-icon">üíæ</div>
                <span class="save-status">Auto-saved just now</span>
            </div>
            <button class="btn-save-exit">Save & Exit</button>
        </div>
    </div>

    <!-- Main Assessment Content -->
    <div class="assessment-main">
        <!-- Progress Bar -->
        <div class="assessment-progress">
            <div class="progress-track">
                <div class="progress-fill" style="width: 25%"></div>
            </div>
            <div class="progress-text">
                <span class="current-step">Step 1 of 4</span>
                <span class="completion-rate">25% Complete</span>
            </div>
        </div>

        <!-- Assessment Form -->
        <form id="health-assessment-form" class="assessment-form">
            
            <!-- STEP 1: BASIC HEALTH PROFILE -->
            <div class="step-content active" id="step-1">
                <div class="step-header">
                    <h1>Basic Health Profile</h1>
                    <p>Let's start with some basic information about you</p>
                </div>

                <div class="form-sections">
                    <!-- Age Range Slider -->
                    <div class="form-section">
                        <label class="section-label">Age Range</label>
                        <div class="age-slider-container">
                            <div class="age-display">
                                <span class="age-value" id="age-value">25</span>
                                <span class="age-unit">years old</span>
                            </div>
                            <div class="slider-wrapper">
                                <input type="range" id="age-slider" min="1" max="120" value="25" class="age-slider">
                                <div class="slider-track">
                                    <div class="slider-fill"></div>
                                </div>
                                <div class="age-markers">
                                    <span>1</span>
                                    <span>30</span>
                                    <span>60</span>
                                    <span>120</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gender Selection -->
                    <div class="form-section">
                        <label class="section-label">Gender Identity</label>
                        <div class="gender-options">
                            <div class="gender-option">
                                <input type="radio" id="male" name="gender" value="male">
                                <label for="male" class="gender-card">
                                    <div class="gender-icon">‚ôÇÔ∏è</div>
                                    <span>Male</span>
                                </label>
                            </div>
                            <div class="gender-option">
                                <input type="radio" id="female" name="gender" value="female">
                                <label for="female" class="gender-card">
                                    <div class="gender-icon">‚ôÄÔ∏è</div>
                                    <span>Female</span>
                                </label>
                            </div>
                            <div class="gender-option">
                                <input type="radio" id="non-binary" name="gender" value="non-binary">
                                <label for="non-binary" class="gender-card">
                                    <div class="gender-icon">‚ößÔ∏è</div>
                                    <span>Non-binary</span>
                                </label>
                            </div>
                            <div class="gender-option">
                                <input type="radio" id="prefer-not-to-say" name="gender" value="prefer-not-to-say">
                                <label for="prefer-not-to-say" class="gender-card">
                                    <div class="gender-icon">‚ùì</div>
                                    <span>Prefer not to say</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Height & Weight -->
                    <div class="form-section">
                        <label class="section-label">Physical Measurements</label>
                        <div class="measurements-grid">
                            <div class="measurement-group">
                                <label for="height">Height</label>
                                <div class="input-with-units">
                                    <input type="number" id="height" placeholder="170" min="50" max="250">
                                    <select id="height-unit" class="unit-selector">
                                        <option value="cm">cm</option>
                                        <option value="ft">ft/in</option>
                                    </select>
                                </div>
                                <div class="conversion-display" id="height-conversion">5'7"</div>
                            </div>
                            <div class="measurement-group">
                                <label for="weight">Weight</label>
                                <div class="input-with-units">
                                    <input type="number" id="weight" placeholder="70" min="20" max="300">
                                    <select id="weight-unit" class="unit-selector">
                                        <option value="kg">kg</option>
                                        <option value="lbs">lbs</option>
                                    </select>
                                </div>
                                <div class="conversion-display" id="weight-conversion">154 lbs</div>
                            </div>
                        </div>
                        <div class="bmi-indicator">
                            <span class="bmi-label">BMI:</span>
                            <span class="bmi-value" id="bmi-value">24.2</span>
                            <span class="bmi-category" id="bmi-category">Normal</span>
                        </div>
                    </div>

                    <!-- Activity Level -->
                    <div class="form-section">
                        <label class="section-label">Activity Level</label>
                        <div class="activity-scale">
                            <div class="activity-option" data-level="1">
                                <input type="radio" id="activity-1" name="activity" value="1">
                                <label for="activity-1" class="activity-card">
                                    <div class="activity-icon">üõãÔ∏è</div>
                                    <div class="activity-info">
                                        <h4>Sedentary</h4>
                                        <p>Little to no exercise</p>
                                    </div>
                                </label>
                            </div>
                            <div class="activity-option" data-level="2">
                                <input type="radio" id="activity-2" name="activity" value="2">
                                <label for="activity-2" class="activity-card">
                                    <div class="activity-icon">üö∂</div>
                                    <div class="activity-info">
                                        <h4>Light</h4>
                                        <p>1-3 days/week</p>
                                    </div>
                                </label>
                            </div>
                            <div class="activity-option" data-level="3">
                                <input type="radio" id="activity-3" name="activity" value="3">
                                <label for="activity-3" class="activity-card">
                                    <div class="activity-icon">üèÉ</div>
                                    <div class="activity-info">
                                        <h4>Moderate</h4>
                                        <p>3-5 days/week</p>
                                    </div>
                                </label>
                            </div>
                            <div class="activity-option" data-level="4">
                                <input type="radio" id="activity-4" name="activity" value="4">
                                <label for="activity-4" class="activity-card">
                                    <div class="activity-icon">üí™</div>
                                    <div class="activity-info">
                                        <h4>Active</h4>
                                        <p>6-7 days/week</p>
                                    </div>
                                </label>
                            </div>
                            <div class="activity-option" data-level="5">
                                <input type="radio" id="activity-5" name="activity" value="5">
                                <label for="activity-5" class="activity-card">
                                    <div class="activity-icon">üèãÔ∏è</div>
                                    <div class="activity-info">
                                        <h4>Very Active</h4>
                                        <p>Intense daily exercise</p>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Current Medications -->
                    <div class="form-section">
                        <label class="section-label">Current Medications</label>
                        <div class="medication-search">
                            <div class="search-input-wrapper">
                                <input type="text" id="medication-search" placeholder="Search for medications..." class="medication-input">
                                <div class="search-icon">üîç</div>
                            </div>
                            <div class="medication-suggestions" id="medication-suggestions">
                                <!-- Dynamic suggestions will appear here -->
                            </div>
                        </div>
                        <div class="selected-medications" id="selected-medications">
                            <!-- Selected medications will appear here -->
                        </div>
                        <div class="no-medications">
                            <label class="checkbox-wrapper">
                                <input type="checkbox" id="no-medications">
                                <span class="checkmark"></span>
                                <span class="checkbox-text">I don't take any medications</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 2: SYMPTOM INPUT -->
            <div class="step-content" id="step-2">
                <div class="step-header">
                    <h1>Describe Your Symptoms</h1>
                    <p>Help us understand what you're experiencing</p>
                </div>

                <div class="form-sections">
                    <!-- Primary Symptom Description -->
                    <div class="form-section">
                        <label class="section-label">Primary Symptom</label>
                        <div class="symptom-input-wrapper">
                            <textarea id="primary-symptom" class="symptom-textarea" placeholder="Describe your main symptom in detail. When did it start? How does it feel? What makes it better or worse?" rows="4"></textarea>
                            <div class="character-count">
                                <span id="symptom-count">0</span>/500 characters
                            </div>
                        </div>
                    </div>

                    <!-- Symptom Duration -->
                    <div class="form-section">
                        <label class="section-label">How long have you been experiencing this?</label>
                        <div class="duration-timeline">
                            <div class="timeline-option">
                                <input type="radio" id="duration-hours" name="duration" value="hours">
                                <label for="duration-hours" class="timeline-card">
                                    <div class="timeline-icon">‚è∞</div>
                                    <span>Few Hours</span>
                                </label>
                            </div>
                            <div class="timeline-option">
                                <input type="radio" id="duration-days" name="duration" value="days">
                                <label for="duration-days" class="timeline-card">
                                    <div class="timeline-icon">üìÖ</div>
                                    <span>Few Days</span>
                                </label>
                            </div>
                            <div class="timeline-option">
                                <input type="radio" id="duration-weeks" name="duration" value="weeks">
                                <label for="duration-weeks" class="timeline-card">
                                    <div class="timeline-icon">üìÜ</div>
                                    <span>Few Weeks</span>
                                </label>
                            </div>
                            <div class="timeline-option">
                                <input type="radio" id="duration-months" name="duration" value="months">
                                <label for="duration-months" class="timeline-card">
                                    <div class="timeline-icon">üóìÔ∏è</div>
                                    <span>Few Months</span>
                                </label>
                            </div>
                            <div class="timeline-option">
                                <input type="radio" id="duration-years" name="duration" value="years">
                                <label for="duration-years" class="timeline-card">
                                    <div class="timeline-icon">üìä</div>
                                    <span>Over a Year</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Severity Scale -->
                    <div class="form-section">
                        <label class="section-label">Pain/Discomfort Level</label>
                        <div class="severity-scale">
                            <div class="pain-faces">
                                <div class="pain-option" data-severity="1">
                                    <input type="radio" id="pain-1" name="severity" value="1">
                                    <label for="pain-1" class="pain-face">
                                        <div class="face-icon">üòä</div>
                                        <span>1</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="2">
                                    <input type="radio" id="pain-2" name="severity" value="2">
                                    <label for="pain-2" class="pain-face">
                                        <div class="face-icon">üôÇ</div>
                                        <span>2</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="3">
                                    <input type="radio" id="pain-3" name="severity" value="3">
                                    <label for="pain-3" class="pain-face">
                                        <div class="face-icon">üòê</div>
                                        <span>3</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="4">
                                    <input type="radio" id="pain-4" name="severity" value="4">
                                    <label for="pain-4" class="pain-face">
                                        <div class="face-icon">üòï</div>
                                        <span>4</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="5">
                                    <input type="radio" id="pain-5" name="severity" value="5">
                                    <label for="pain-5" class="pain-face">
                                        <div class="face-icon">üòü</div>
                                        <span>5</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="6">
                                    <input type="radio" id="pain-6" name="severity" value="6">
                                    <label for="pain-6" class="pain-face">
                                        <div class="face-icon">üò£</div>
                                        <span>6</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="7">
                                    <input type="radio" id="pain-7" name="severity" value="7">
                                    <label for="pain-7" class="pain-face">
                                        <div class="face-icon">üòñ</div>
                                        <span>7</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="8">
                                    <input type="radio" id="pain-8" name="severity" value="8">
                                    <label for="pain-8" class="pain-face">
                                        <div class="face-icon">üò´</div>
                                        <span>8</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="9">
                                    <input type="radio" id="pain-9" name="severity" value="9">
                                    <label for="pain-9" class="pain-face">
                                        <div class="face-icon">üò∞</div>
                                        <span>9</span>
                                    </label>
                                </div>
                                <div class="pain-option" data-severity="10">
                                    <input type="radio" id="pain-10" name="severity" value="10">
                                    <label for="pain-10" class="pain-face">
                                        <div class="face-icon">üò±</div>
                                        <span>10</span>
                                    </label>
                                </div>
                            </div>
                            <div class="severity-labels">
                                <span class="severity-min">No Pain</span>
                                <span class="severity-max">Worst Pain</span>
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Body Diagram -->
                    <div class="form-section">
                        <label class="section-label">Where are you experiencing symptoms?</label>
                        <div class="body-diagram-container">
                            <div class="body-diagram">
                                <!-- Enhanced body diagram with detailed clickable areas -->
                                <svg viewBox="0 0 400 600" class="body-svg" id="body-svg">
                                    <!-- Head & Face -->
                                    <circle cx="200" cy="80" r="40" class="body-part" data-part="head" />
                                    <text x="200" y="85" text-anchor="middle" class="body-label">Head</text>
                                    
                                    <!-- Eyes -->
                                    <circle cx="185" cy="70" r="3" class="body-part" data-part="eyes" />
                                    <circle cx="215" cy="70" r="3" class="body-part" data-part="eyes" />
                                    
                                    <!-- Mouth -->
                                    <ellipse cx="200" cy="90" rx="8" ry="4" class="body-part" data-part="mouth" />
                                    
                                    <!-- Neck -->
                                    <rect x="185" y="120" width="30" height="20" class="body-part" data-part="neck" />
                                    <text x="200" y="135" text-anchor="middle" class="body-label">Neck</text>
                                    
                                    <!-- Chest -->
                                    <rect x="160" y="140" width="80" height="60" rx="10" class="body-part" data-part="chest" />
                                    <text x="200" y="175" text-anchor="middle" class="body-label">Chest</text>
                                    
                                    <!-- Heart area -->
                                    <circle cx="200" cy="160" r="15" class="body-part" data-part="heart" />
                                    
                                    <!-- Abdomen -->
                                    <rect x="165" y="200" width="70" height="50" rx="5" class="body-part" data-part="abdomen" />
                                    <text x="200" y="230" text-anchor="middle" class="body-label">Abdomen</text>
                                    
                                    <!-- Stomach area -->
                                    <circle cx="200" cy="220" r="12" class="body-part" data-part="stomach" />
                                    
                                    <!-- Left Arm -->
                                    <rect x="120" y="140" width="25" height="80" rx="12" class="body-part" data-part="left-arm" />
                                    <text x="132" y="185" text-anchor="middle" class="body-label">L Arm</text>
                                    
                                    <!-- Right Arm -->
                                    <rect x="255" y="140" width="25" height="80" rx="12" class="body-part" data-part="right-arm" />
                                    <text x="267" y="185" text-anchor="middle" class="body-label">R Arm</text>
                                    
                                    <!-- Left Leg -->
                                    <rect x="170" y="250" width="25" height="120" rx="12" class="body-part" data-part="left-leg" />
                                    <text x="182" y="315" text-anchor="middle" class="body-label">L Leg</text>
                                    
                                    <!-- Right Leg -->
                                    <rect x="205" y="250" width="25" height="120" rx="12" class="body-part" data-part="right-leg" />
                                    <text x="217" y="315" text-anchor="middle" class="body-label">R Leg</text>
                                    
                                    <!-- Back view (hidden by default) -->
                                    <g class="back-view" style="display: none;">
                                        <!-- Back -->
                                        <rect x="160" y="140" width="80" height="110" rx="10" class="body-part" data-part="back" />
                                        <text x="200" y="200" text-anchor="middle" class="body-label">Back</text>
                                        
                                        <!-- Spine -->
                                        <rect x="195" y="140" width="10" height="110" class="body-part" data-part="spine" />
                                        
                                        <!-- Shoulder blades -->
                                        <ellipse cx="175" cy="160" rx="15" ry="8" class="body-part" data-part="left-shoulder" />
                                        <ellipse cx="225" cy="160" rx="15" ry="8" class="body-part" data-part="right-shoulder" />
                                    </g>
                                </svg>
                                
                                <div class="body-view-toggle">
                                    <button type="button" class="view-btn active" data-view="front" aria-label="Front view">
                                        <span class="view-icon">üë§</span>
                                        Front
                                    </button>
                                    <button type="button" class="view-btn" data-view="back" aria-label="Back view">
                                        <span class="view-icon">üë§</span>
                                        Back
                                    </button>
                                </div>
                            </div>
                            
                            <div class="selected-areas">
                                <h4>Selected Areas:</h4>
                                <div class="area-tags" id="selected-body-areas">
                                    <!-- Selected body parts will appear here -->
                                </div>
                                <button type="button" class="clear-areas-btn" id="clear-body-areas" style="display: none;">
                                    Clear All
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Symptoms -->
                    <div class="form-section">
                        <label class="section-label">Additional Symptoms (Select all that apply)</label>
                        <div class="symptoms-grid">
                            <label class="symptom-checkbox">
                                <input type="checkbox" name="additional-symptoms" value="fever">
                                <span class="checkmark"></span>
                                <div class="symptom-info">
                                    <div class="symptom-icon">üå°Ô∏è</div>
                                    <span>Fever</span>
                                </div>
                            </label>
                            <label class="symptom-checkbox">
                                <input type="checkbox" name="additional-symptoms" value="headache">
                                <span class="checkmark"></span>
                                <div class="symptom-info">
                                    <div class="symptom-icon">ü§ï</div>
                                    <span>Headache</span>
                                </div>
                            </label>
                            <label class="symptom-checkbox">
                                <input type="checkbox" name="additional-symptoms" value="nausea">
                                <span class="checkmark"></span>
                                <div class="symptom-info">
                                    <div class="symptom-icon">ü§¢</div>
                                    <span>Nausea</span>
                                </div>
                            </label>
                            <label class="symptom-checkbox">
                                <input type="checkbox" name="additional-symptoms" value="fatigue">
                                <span class="checkmark"></span>
                                <div class="symptom-info">
                                    <div class="symptom-icon">üò¥</div>
                                    <span>Fatigue</span>
                                </div>
                            </label>
                            <label class="symptom-checkbox">
                                <input type="checkbox" name="additional-symptoms" value="dizziness">
                                <span class="checkmark"></span>
                                <div class="symptom-info">
                                    <div class="symptom-icon">üí´</div>
                                    <span>Dizziness</span>
                                </div>
                            </label>
                            <label class="symptom-checkbox">
                                <input type="checkbox" name="additional-symptoms" value="shortness-of-breath">
                                <span class="checkmark"></span>
                                <div class="symptom-info">
                                    <div class="symptom-icon">ü´Å</div>
                                    <span>Shortness of Breath</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 3: CONTEXTUAL QUESTIONS -->
            <div class="step-content" id="step-3">
                <div class="step-header">
                    <h1>Contextual Questions</h1>
                    <p>Help us understand your medical history and context</p>
                </div>

                <div class="form-sections">
                    <!-- Dynamic Questions Container -->
                    <div class="dynamic-questions" id="dynamic-questions">
                        <!-- Default contextual questions -->
                        <div class="question-group" data-category="general">
                            <div class="form-section">
                                <label class="section-label">Do you have any known allergies?</label>
                                <div class="yes-no-toggle">
                                    <input type="radio" id="allergies-yes" name="allergies" value="yes">
                                    <label for="allergies-yes" class="toggle-option">Yes</label>
                                    <input type="radio" id="allergies-no" name="allergies" value="no">
                                    <label for="allergies-no" class="toggle-option">No</label>
                                </div>
                                <div class="follow-up" id="allergies-details" style="display: none;">
                                    <textarea placeholder="Please describe your allergies..." rows="3"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="question-group" data-category="general">
                            <div class="form-section">
                                <label class="section-label">Are you currently pregnant or breastfeeding?</label>
                                <div class="yes-no-toggle">
                                    <input type="radio" id="pregnancy-yes" name="pregnancy" value="yes">
                                    <label for="pregnancy-yes" class="toggle-option">Yes</label>
                                    <input type="radio" id="pregnancy-no" name="pregnancy" value="no">
                                    <label for="pregnancy-no" class="toggle-option">No</label>
                                    <input type="radio" id="pregnancy-na" name="pregnancy" value="not-applicable">
                                    <label for="pregnancy-na" class="toggle-option">Not Applicable</label>
                                </div>
                            </div>
                        </div>

                        <div class="question-group" data-category="medical-history">
                            <div class="form-section">
                                <label class="section-label">Do you have any chronic medical conditions?</label>
                                <div class="yes-no-toggle">
                                    <input type="radio" id="chronic-yes" name="chronic-conditions" value="yes">
                                    <label for="chronic-yes" class="toggle-option">Yes</label>
                                    <input type="radio" id="chronic-no" name="chronic-conditions" value="no">
                                    <label for="chronic-no" class="toggle-option">No</label>
                                </div>
                                <div class="follow-up" id="chronic-details" style="display: none;">
                                    <div class="condition-selector">
                                        <label class="checkbox-wrapper">
                                            <input type="checkbox" name="conditions" value="diabetes">
                                            <span class="checkmark"></span>
                                            <span class="checkbox-text">Diabetes</span>
                                        </label>
                                        <label class="checkbox-wrapper">
                                            <input type="checkbox" name="conditions" value="hypertension">
                                            <span class="checkmark"></span>
                                            <span class="checkbox-text">High Blood Pressure</span>
                                        </label>
                                        <label class="checkbox-wrapper">
                                            <input type="checkbox" name="conditions" value="heart-disease">
                                            <span class="checkmark"></span>
                                            <span class="checkbox-text">Heart Disease</span>
                                        </label>
                                        <label class="checkbox-wrapper">
                                            <input type="checkbox" name="conditions" value="asthma">
                                            <span class="checkmark"></span>
                                            <span class="checkbox-text">Asthma</span>
                                        </label>
                                        <label class="checkbox-wrapper">
                                            <input type="checkbox" name="conditions" value="arthritis">
                                            <span class="checkmark"></span>
                                            <span class="checkbox-text">Arthritis</span>
                                        </label>
                                        <label class="checkbox-wrapper">
                                            <input type="checkbox" name="conditions" value="other">
                                            <span class="checkmark"></span>
                                            <span class="checkbox-text">Other</span>
                                        </label>
                                    </div>
                                    <textarea placeholder="Please specify other conditions..." rows="2" style="display: none;"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Dynamic questions will be added here based on previous answers -->
                        <div class="dynamic-questions-container" id="dynamic-questions-container">
                            <!-- Questions will be populated based on previous answers -->
                        </div>
                    </div>

                    <!-- Symptom Onset Date -->
                    <div class="form-section">
                        <label class="section-label">When did your symptoms first appear?</label>
                        <div class="date-picker-wrapper">
                            <input type="date" id="symptom-onset" class="date-input">
                            <div class="date-helper">
                                <button type="button" class="date-preset" data-days="1">Yesterday</button>
                                <button type="button" class="date-preset" data-days="7">1 Week Ago</button>
                                <button type="button" class="date-preset" data-days="30">1 Month Ago</button>
                            </div>
                        </div>
                    </div>

                    <!-- File Upload -->
                    <div class="form-section">
                        <label class="section-label">Medical Documents or Images (Optional)</label>
                        <div class="file-upload-area" id="file-upload-area">
                            <div class="upload-content">
                                <div class="upload-icon">üìÑ</div>
                                <h4>Drag & drop files here</h4>
                                <p>or <button type="button" class="upload-button">browse files</button></p>
                                <small>Supported: PDF, JPG, PNG, DOCX (Max 10MB each)</small>
                            </div>
                            <input type="file" id="file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.docx" style="display: none;">
                        </div>
                        <div class="uploaded-files" id="uploaded-files">
                            <!-- Uploaded files will appear here -->
                        </div>
                    </div>

                    <!-- Voice Recording -->
                    <div class="form-section">
                        <label class="section-label">Voice Description (Optional)</label>
                        <div class="voice-recorder">
                            <div class="recorder-controls">
                                <button type="button" id="start-recording" class="record-btn">
                                    <div class="record-icon">üé§</div>
                                    <span>Start Recording</span>
                                </button>
                                <button type="button" id="stop-recording" class="record-btn stop" style="display: none;">
                                    <div class="record-icon">‚èπÔ∏è</div>
                                    <span>Stop Recording</span>
                                </button>
                            </div>
                            <div class="recording-status" id="recording-status" style="display: none;">
                                <div class="recording-animation">
                                    <div class="pulse"></div>
                                </div>
                                <span class="recording-time">00:00</span>
                            </div>
                            <div class="recorded-audio" id="recorded-audio" style="display: none;">
                                <!-- Audio player will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- STEP 4: AI ANALYSIS PREVIEW -->
            <div class="step-content" id="step-4">
                <!-- Loading Screen -->
                <div class="analysis-loading" id="analysis-loading">
                    <div class="loading-animation">
                        <div class="medical-spinner">
                            <div class="spinner-ring">
                                <div class="ring-segment"></div>
                                <div class="ring-segment"></div>
                                <div class="ring-segment"></div>
                                <div class="ring-segment"></div>
                            </div>
                            <div class="spinner-cross">
                                <div class="cross-horizontal"></div>
                                <div class="cross-vertical"></div>
                            </div>
                            <div class="spinner-pulse"></div>
                        </div>
                    </div>
                    <div class="loading-messages">
                        <h2>AI Health Analysis in Progress</h2>
                        <p class="loading-subtitle">Our advanced AI is processing your health information</p>
                        <div class="progress-messages">
                            <div class="message active" data-step="1">
                                <div class="message-icon">üîç</div>
                                <div class="message-content">
                                    <h4>Analyzing symptoms...</h4>
                                    <p>Processing your symptom descriptions and patterns</p>
                                </div>
                                <div class="message-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 20%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="message" data-step="2">
                                <div class="message-icon">üß†</div>
                                <div class="message-content">
                                    <h4>Cross-referencing medical database...</h4>
                                    <p>Comparing with 10,000+ medical conditions and treatments</p>
                                </div>
                                <div class="message-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 40%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="message" data-step="3">
                                <div class="message-icon">üìä</div>
                                <div class="message-content">
                                    <h4>Calculating risk factors...</h4>
                                    <p>Analyzing your health profile and risk assessment</p>
                                </div>
                                <div class="message-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 60%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="message" data-step="4">
                                <div class="message-icon">üí°</div>
                                <div class="message-content">
                                    <h4>Generating recommendations...</h4>
                                    <p>Creating personalized health recommendations</p>
                                </div>
                                <div class="message-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 80%"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="message" data-step="5">
                                <div class="message-icon">‚úÖ</div>
                                <div class="message-content">
                                    <h4>Analysis complete!</h4>
                                    <p>Your personalized health report is ready</p>
                                </div>
                                <div class="message-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="loading-tips">
                            <h4>üí° Did you know?</h4>
                            <p class="tip-text">Our AI analyzes over 50 health factors to provide the most accurate assessment possible.</p>
                        </div>
                    </div>
                </div>

                <!-- Analysis Results -->
                <div class="analysis-results" id="analysis-results" style="display: none;">
                    <div class="step-header">
                        <h1>AI Analysis Results</h1>
                        <p>Based on your responses, here's what we found</p>
                    </div>

                    <div class="results-sections">
                        <!-- Risk Level Indicator -->
                        <div class="risk-indicator">
                            <div class="risk-level medium" id="risk-level">
                                <div class="risk-icon">‚ö†Ô∏è</div>
                                <div class="risk-info">
                                    <h3>Medium Risk Level</h3>
                                    <p>Some symptoms require attention</p>
                                </div>
                            </div>
                        </div>

                        <!-- Preliminary Insights -->
                        <div class="insights-section">
                            <h3>Preliminary Insights</h3>
                            <div class="insights-grid">
                                <div class="insight-card">
                                    <div class="insight-icon">üéØ</div>
                                    <div class="insight-content">
                                        <h4>Possible Conditions</h4>
                                        <ul id="possible-conditions">
                                            <li>Common cold (70% match)</li>
                                            <li>Seasonal allergies (45% match)</li>
                                            <li>Viral infection (30% match)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon">‚è∞</div>
                                    <div class="insight-content">
                                        <h4>Timeline</h4>
                                        <p id="symptom-timeline">Symptoms started 3 days ago and are progressing normally for this type of condition.</p>
                                    </div>
                                </div>
                                <div class="insight-card">
                                    <div class="insight-icon">üîç</div>
                                    <div class="insight-content">
                                        <h4>Key Factors</h4>
                                        <ul id="key-factors">
                                            <li>Recent weather changes</li>
                                            <li>Seasonal timing</li>
                                            <li>Symptom combination</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Recommendations -->
                        <div class="recommendations-section">
                            <h3>Recommended Next Steps</h3>
                            <div class="recommendations-list">
                                <div class="recommendation urgent">
                                    <div class="rec-priority">üö®</div>
                                    <div class="rec-content">
                                        <h4>Immediate Action</h4>
                                        <p>Monitor symptoms closely and seek medical attention if they worsen.</p>
                                    </div>
                                </div>
                                <div class="recommendation important">
                                    <div class="rec-priority">‚ö°</div>
                                    <div class="rec-content">
                                        <h4>Within 24 Hours</h4>
                                        <p>Consider scheduling an appointment with your primary care physician.</p>
                                    </div>
                                </div>
                                <div class="recommendation general">
                                    <div class="rec-priority">üí°</div>
                                    <div class="rec-content">
                                        <h4>General Care</h4>
                                        <p>Rest, stay hydrated, and avoid strenuous activities.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Navigation -->
            <div class="form-navigation">
                <button type="button" id="prev-step" class="nav-btn secondary" disabled>
                    <span class="btn-icon">‚Üê</span>
                    Previous
                </button>
                
                <div class="nav-info">
                    <span class="step-indicator">Step <span id="current-step-num">1</span> of 4</span>
                </div>
                
                <button type="button" id="next-step" class="nav-btn primary">
                    Next
                    <span class="btn-icon">‚Üí</span>
                </button>
                
                <button type="submit" id="submit-assessment" class="nav-btn success" style="display: none;">
                    <span class="btn-icon">‚úì</span>
                    Complete Assessment
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block js %}
<script src="/static/js/assessment.js"></script>
<script src="/static/js/assessment-interface.js"></script>
<script src="/static/js/assessment-steps.js"></script>
{% endblock %}